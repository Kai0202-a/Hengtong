{"ast":null,"code":"import _objectSpread from\"C:/Users/cow7353202th/Desktop/APP/car-parts-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useContext,useEffect,useState}from'react';import{partsData}from\"./partsData\";import{useNavigate}from'react-router-dom';import{UserContext}from'../UserContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function getToday(){const d=new Date();const pad=n=>n.toString().padStart(2,'0');return\"\".concat(d.getFullYear(),\"-\").concat(pad(d.getMonth()+1),\"-\").concat(pad(d.getDate()),\" \").concat(pad(d.getHours()),\":\").concat(pad(d.getMinutes()),\":\").concat(pad(d.getSeconds()));}function ShippingStats(props){const{parts,setParts}=props;const navigate=useNavigate();const{user}=useContext(UserContext);// 只保留這一行\nuseEffect(()=>{const localUser=user||JSON.parse(localStorage.getItem('user'));if(!localUser||localUser.role!=='dealer'&&localUser.role!=='admin'){navigate('/');}},[user,navigate]);const today=getToday();const[quantities,setQuantities]=useState(Array(parts.length).fill(\"\"));// 刪除這一行：const { user } = useContext(UserContext);\nconst handleQuantityChange=(idx,value)=>{const newQuantities=[...quantities];newQuantities[idx]=value;setQuantities(newQuantities);};const handleSubmit=async e=>{e.preventDefault();const newParts=parts.map((part,idx)=>{const qty=parseInt(quantities[idx],10)||0;return _objectSpread(_objectSpread({},part),{},{stock:part.stock-qty});});setParts(newParts);try{const userObj=user||JSON.parse(localStorage.getItem('user'));for(let idx=0;idx<parts.length;idx++){const part=parts[idx];const qty=parseInt(quantities[idx],10)||0;if(qty>0){const res=await fetch('https://hengtong.vercel.app/api/shipments',{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(userObj.token)},body:JSON.stringify({company:(userObj===null||userObj===void 0?void 0:userObj.company)||(userObj===null||userObj===void 0?void 0:userObj.username)||'',partId:part.id,partName:part.name,quantity:qty,price:part.price,amount:qty*part.price,time:today})});if(!res.ok)throw new Error('API 錯誤');}}alert('發送完成！');}catch(err){alert('發送失敗，請稍後再試！');}};return/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',marginBottom:16},children:[/*#__PURE__*/_jsx(\"img\",{src:\"images/logo2.png\",alt:\"Logo\",style:{height:150}}),/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:600,margin:'0 auto',padding:16},children:[/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',marginBottom:16,fontWeight:'bold',fontSize:28},children:[\"\\u51FA\\u8CA8\\u65E5\\u671F\\uFF1A\",today]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"table\",{style:{width:'100%',textAlign:'center',verticalAlign:'middle',tableLayout:'fixed'},className:\"center-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"\\u5716\\u7247\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u54C1\\u865F\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u552E\\u50F9\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u51FA\\u8CA8\\u6578\\u91CF\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:parts.map((item,idx)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{style:{textAlign:'center',verticalAlign:'middle'},children:item.image&&/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:item.name,style:{width:60,height:60,objectFit:'cover'}})}),/*#__PURE__*/_jsx(\"td\",{children:item.name}),/*#__PURE__*/_jsx(\"td\",{children:item.price}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",value:quantities[idx],onChange:e=>handleQuantityChange(idx,e.target.value),style:{width:60}})})]},item.id))})]}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',marginTop:16},children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",style:{fontSize:24,padding:'12px 32px'},children:\"\\u9001\\u51FA\"})})]})]})]});}export default ShippingStats;","map":{"version":3,"names":["React","useContext","useEffect","useState","partsData","useNavigate","UserContext","jsx","_jsx","jsxs","_jsxs","getToday","d","Date","pad","n","toString","padStart","concat","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","ShippingStats","props","parts","setParts","navigate","user","localUser","JSON","parse","localStorage","getItem","role","today","quantities","setQuantities","Array","length","fill","handleQuantityChange","idx","value","newQuantities","handleSubmit","e","preventDefault","newParts","map","part","qty","parseInt","_objectSpread","stock","userObj","res","fetch","method","headers","token","body","stringify","company","username","partId","id","partName","name","quantity","price","amount","time","ok","Error","alert","err","style","textAlign","marginBottom","children","src","alt","height","maxWidth","margin","padding","fontWeight","fontSize","onSubmit","width","verticalAlign","tableLayout","className","item","image","objectFit","type","min","onChange","target","marginTop"],"sources":["C:/Users/cow7353202th/Desktop/APP/car-parts-frontend/src/pages/ShippingStats.js"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\r\nimport { partsData } from \"./partsData\";\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { UserContext } from '../UserContext';\r\n\r\nfunction getToday() {\r\n  const d = new Date();\r\n  const pad = n => n.toString().padStart(2, '0');\r\n  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;\r\n}\r\n\r\nfunction ShippingStats(props) {\r\n  const { parts, setParts } = props;\r\n  const navigate = useNavigate();\r\n  const { user } = useContext(UserContext); // 只保留這一行\r\n  useEffect(() => {\r\n    const localUser = user || JSON.parse(localStorage.getItem('user'));\r\n    if (!localUser || (localUser.role !== 'dealer' && localUser.role !== 'admin')) {\r\n      navigate('/');\r\n    }\r\n  }, [user, navigate]);\r\n  const today = getToday();\r\n  const [quantities, setQuantities] = useState(Array(parts.length).fill(\"\"));\r\n  // 刪除這一行：const { user } = useContext(UserContext);\r\n  const handleQuantityChange = (idx, value) => {\r\n    const newQuantities = [...quantities];\r\n    newQuantities[idx] = value;\r\n    setQuantities(newQuantities);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    const newParts = parts.map((part, idx) => {\r\n      const qty = parseInt(quantities[idx], 10) || 0;\r\n      return {\r\n        ...part,\r\n        stock: part.stock - qty\r\n      };\r\n    });\r\n    setParts(newParts);\r\n    try {\r\n      const userObj = user || JSON.parse(localStorage.getItem('user'));\r\n      for (let idx = 0; idx < parts.length; idx++) {\r\n        const part = parts[idx];\r\n        const qty = parseInt(quantities[idx], 10) || 0;\r\n        if (qty > 0) {\r\n          const res = await fetch('https://hengtong.vercel.app/api/shipments', {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n              'Authorization': `Bearer ${userObj.token}`\r\n            },\r\n            body: JSON.stringify({\r\n              company: userObj?.company || userObj?.username || '',\r\n              partId: part.id,\r\n              partName: part.name,\r\n              quantity: qty,\r\n              price: part.price,\r\n              amount: qty * part.price,\r\n              time: today\r\n            })\r\n          });\r\n          if (!res.ok) throw new Error('API 錯誤');\r\n        }\r\n      }\r\n      alert('發送完成！');\r\n    } catch (err) {\r\n      alert('發送失敗，請稍後再試！');\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ textAlign: 'center', marginBottom: 16 }}>\r\n      <img src=\"images/logo2.png\" alt=\"Logo\" style={{ height: 150 }} />\r\n      <div style={{ maxWidth: 600, margin: '0 auto', padding: 16 }}>\r\n        <div style={{ textAlign: 'center', marginBottom: 16, fontWeight: 'bold', fontSize: 28 }}>\r\n          出貨日期：{today}\r\n        </div>\r\n        <form onSubmit={handleSubmit}>\r\n          <table style={{ width: '100%', textAlign: 'center', verticalAlign: 'middle', tableLayout: 'fixed' }} className=\"center-table\">\r\n            <thead>\r\n              <tr>\r\n                <th>圖片</th>\r\n                <th>品號</th>\r\n                <th>售價</th>\r\n                <th>出貨數量</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {parts.map((item, idx) => (\r\n                <tr key={item.id}>\r\n                  <td style={{ textAlign: 'center', verticalAlign: 'middle' }}>\r\n                    {item.image && <img src={item.image} alt={item.name} style={{ width: 60, height: 60, objectFit: 'cover' }} />}\r\n                  </td>\r\n                  <td>{item.name}</td>\r\n                  <td>{item.price}</td>\r\n                  <td>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"0\"\r\n                      value={quantities[idx]}\r\n                      onChange={e => handleQuantityChange(idx, e.target.value)}\r\n                      style={{ width: 60 }}\r\n                    />\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n          <div style={{ textAlign: 'center', marginTop: 16 }}>\r\n            <button type=\"submit\" style={{ fontSize: 24, padding: '12px 32px' }}>送出</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ShippingStats;"],"mappings":"yIAAA,MAAO,CAAAA,KAAK,EAAIC,UAAU,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC9D,OAASC,SAAS,KAAQ,aAAa,CACvC,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,WAAW,KAAQ,gBAAgB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE7C,QAAS,CAAAC,QAAQA,CAAA,CAAG,CAClB,KAAM,CAAAC,CAAC,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CACpB,KAAM,CAAAC,GAAG,CAAGC,CAAC,EAAIA,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,CAC9C,SAAAC,MAAA,CAAUN,CAAC,CAACO,WAAW,CAAC,CAAC,MAAAD,MAAA,CAAIJ,GAAG,CAACF,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,MAAAF,MAAA,CAAIJ,GAAG,CAACF,CAAC,CAACS,OAAO,CAAC,CAAC,CAAC,MAAAH,MAAA,CAAIJ,GAAG,CAACF,CAAC,CAACU,QAAQ,CAAC,CAAC,CAAC,MAAAJ,MAAA,CAAIJ,GAAG,CAACF,CAAC,CAACW,UAAU,CAAC,CAAC,CAAC,MAAAL,MAAA,CAAIJ,GAAG,CAACF,CAAC,CAACY,UAAU,CAAC,CAAC,CAAC,EACzI,CAEA,QAAS,CAAAC,aAAaA,CAACC,KAAK,CAAE,CAC5B,KAAM,CAAEC,KAAK,CAAEC,QAAS,CAAC,CAAGF,KAAK,CACjC,KAAM,CAAAG,QAAQ,CAAGxB,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAEyB,IAAK,CAAC,CAAG7B,UAAU,CAACK,WAAW,CAAC,CAAE;AAC1CJ,SAAS,CAAC,IAAM,CACd,KAAM,CAAA6B,SAAS,CAAGD,IAAI,EAAIE,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,CAClE,GAAI,CAACJ,SAAS,EAAKA,SAAS,CAACK,IAAI,GAAK,QAAQ,EAAIL,SAAS,CAACK,IAAI,GAAK,OAAQ,CAAE,CAC7EP,QAAQ,CAAC,GAAG,CAAC,CACf,CACF,CAAC,CAAE,CAACC,IAAI,CAAED,QAAQ,CAAC,CAAC,CACpB,KAAM,CAAAQ,KAAK,CAAG1B,QAAQ,CAAC,CAAC,CACxB,KAAM,CAAC2B,UAAU,CAAEC,aAAa,CAAC,CAAGpC,QAAQ,CAACqC,KAAK,CAACb,KAAK,CAACc,MAAM,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC,CAAC,CAC1E;AACA,KAAM,CAAAC,oBAAoB,CAAGA,CAACC,GAAG,CAAEC,KAAK,GAAK,CAC3C,KAAM,CAAAC,aAAa,CAAG,CAAC,GAAGR,UAAU,CAAC,CACrCQ,aAAa,CAACF,GAAG,CAAC,CAAGC,KAAK,CAC1BN,aAAa,CAACO,aAAa,CAAC,CAC9B,CAAC,CAED,KAAM,CAAAC,YAAY,CAAG,KAAO,CAAAC,CAAC,EAAK,CAChCA,CAAC,CAACC,cAAc,CAAC,CAAC,CAClB,KAAM,CAAAC,QAAQ,CAAGvB,KAAK,CAACwB,GAAG,CAAC,CAACC,IAAI,CAAER,GAAG,GAAK,CACxC,KAAM,CAAAS,GAAG,CAAGC,QAAQ,CAAChB,UAAU,CAACM,GAAG,CAAC,CAAE,EAAE,CAAC,EAAI,CAAC,CAC9C,OAAAW,aAAA,CAAAA,aAAA,IACKH,IAAI,MACPI,KAAK,CAAEJ,IAAI,CAACI,KAAK,CAAGH,GAAG,GAE3B,CAAC,CAAC,CACFzB,QAAQ,CAACsB,QAAQ,CAAC,CAClB,GAAI,CACF,KAAM,CAAAO,OAAO,CAAG3B,IAAI,EAAIE,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,CAChE,IAAK,GAAI,CAAAS,GAAG,CAAG,CAAC,CAAEA,GAAG,CAAGjB,KAAK,CAACc,MAAM,CAAEG,GAAG,EAAE,CAAE,CAC3C,KAAM,CAAAQ,IAAI,CAAGzB,KAAK,CAACiB,GAAG,CAAC,CACvB,KAAM,CAAAS,GAAG,CAAGC,QAAQ,CAAChB,UAAU,CAACM,GAAG,CAAC,CAAE,EAAE,CAAC,EAAI,CAAC,CAC9C,GAAIS,GAAG,CAAG,CAAC,CAAE,CACX,KAAM,CAAAK,GAAG,CAAG,KAAM,CAAAC,KAAK,CAAC,2CAA2C,CAAE,CACnEC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAAkB,CAClC,eAAe,WAAA3C,MAAA,CAAYuC,OAAO,CAACK,KAAK,CAC1C,CAAC,CACDC,IAAI,CAAE/B,IAAI,CAACgC,SAAS,CAAC,CACnBC,OAAO,CAAE,CAAAR,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAEQ,OAAO,IAAIR,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAES,QAAQ,GAAI,EAAE,CACpDC,MAAM,CAAEf,IAAI,CAACgB,EAAE,CACfC,QAAQ,CAAEjB,IAAI,CAACkB,IAAI,CACnBC,QAAQ,CAAElB,GAAG,CACbmB,KAAK,CAAEpB,IAAI,CAACoB,KAAK,CACjBC,MAAM,CAAEpB,GAAG,CAAGD,IAAI,CAACoB,KAAK,CACxBE,IAAI,CAAErC,KACR,CAAC,CACH,CAAC,CAAC,CACF,GAAI,CAACqB,GAAG,CAACiB,EAAE,CAAE,KAAM,IAAI,CAAAC,KAAK,CAAC,QAAQ,CAAC,CACxC,CACF,CACAC,KAAK,CAAC,OAAO,CAAC,CAChB,CAAE,MAAOC,GAAG,CAAE,CACZD,KAAK,CAAC,aAAa,CAAC,CACtB,CACF,CAAC,CAED,mBACEnE,KAAA,QAAKqE,KAAK,CAAE,CAAEC,SAAS,CAAE,QAAQ,CAAEC,YAAY,CAAE,EAAG,CAAE,CAAAC,QAAA,eACpD1E,IAAA,QAAK2E,GAAG,CAAC,kBAAkB,CAACC,GAAG,CAAC,MAAM,CAACL,KAAK,CAAE,CAAEM,MAAM,CAAE,GAAI,CAAE,CAAE,CAAC,cACjE3E,KAAA,QAAKqE,KAAK,CAAE,CAAEO,QAAQ,CAAE,GAAG,CAAEC,MAAM,CAAE,QAAQ,CAAEC,OAAO,CAAE,EAAG,CAAE,CAAAN,QAAA,eAC3DxE,KAAA,QAAKqE,KAAK,CAAE,CAAEC,SAAS,CAAE,QAAQ,CAAEC,YAAY,CAAE,EAAE,CAAEQ,UAAU,CAAE,MAAM,CAAEC,QAAQ,CAAE,EAAG,CAAE,CAAAR,QAAA,EAAC,gCAClF,CAAC7C,KAAK,EACR,CAAC,cACN3B,KAAA,SAAMiF,QAAQ,CAAE5C,YAAa,CAAAmC,QAAA,eAC3BxE,KAAA,UAAOqE,KAAK,CAAE,CAAEa,KAAK,CAAE,MAAM,CAAEZ,SAAS,CAAE,QAAQ,CAAEa,aAAa,CAAE,QAAQ,CAAEC,WAAW,CAAE,OAAQ,CAAE,CAACC,SAAS,CAAC,cAAc,CAAAb,QAAA,eAC3H1E,IAAA,UAAA0E,QAAA,cACExE,KAAA,OAAAwE,QAAA,eACE1E,IAAA,OAAA0E,QAAA,CAAI,cAAE,CAAI,CAAC,cACX1E,IAAA,OAAA0E,QAAA,CAAI,cAAE,CAAI,CAAC,cACX1E,IAAA,OAAA0E,QAAA,CAAI,cAAE,CAAI,CAAC,cACX1E,IAAA,OAAA0E,QAAA,CAAI,0BAAI,CAAI,CAAC,EACX,CAAC,CACA,CAAC,cACR1E,IAAA,UAAA0E,QAAA,CACGvD,KAAK,CAACwB,GAAG,CAAC,CAAC6C,IAAI,CAAEpD,GAAG,gBACnBlC,KAAA,OAAAwE,QAAA,eACE1E,IAAA,OAAIuE,KAAK,CAAE,CAAEC,SAAS,CAAE,QAAQ,CAAEa,aAAa,CAAE,QAAS,CAAE,CAAAX,QAAA,CACzDc,IAAI,CAACC,KAAK,eAAIzF,IAAA,QAAK2E,GAAG,CAAEa,IAAI,CAACC,KAAM,CAACb,GAAG,CAAEY,IAAI,CAAC1B,IAAK,CAACS,KAAK,CAAE,CAAEa,KAAK,CAAE,EAAE,CAAEP,MAAM,CAAE,EAAE,CAAEa,SAAS,CAAE,OAAQ,CAAE,CAAE,CAAC,CAC3G,CAAC,cACL1F,IAAA,OAAA0E,QAAA,CAAKc,IAAI,CAAC1B,IAAI,CAAK,CAAC,cACpB9D,IAAA,OAAA0E,QAAA,CAAKc,IAAI,CAACxB,KAAK,CAAK,CAAC,cACrBhE,IAAA,OAAA0E,QAAA,cACE1E,IAAA,UACE2F,IAAI,CAAC,QAAQ,CACbC,GAAG,CAAC,GAAG,CACPvD,KAAK,CAAEP,UAAU,CAACM,GAAG,CAAE,CACvByD,QAAQ,CAAErD,CAAC,EAAIL,oBAAoB,CAACC,GAAG,CAAEI,CAAC,CAACsD,MAAM,CAACzD,KAAK,CAAE,CACzDkC,KAAK,CAAE,CAAEa,KAAK,CAAE,EAAG,CAAE,CACtB,CAAC,CACA,CAAC,GAdEI,IAAI,CAAC5B,EAeV,CACL,CAAC,CACG,CAAC,EACH,CAAC,cACR5D,IAAA,QAAKuE,KAAK,CAAE,CAAEC,SAAS,CAAE,QAAQ,CAAEuB,SAAS,CAAE,EAAG,CAAE,CAAArB,QAAA,cACjD1E,IAAA,WAAQ2F,IAAI,CAAC,QAAQ,CAACpB,KAAK,CAAE,CAAEW,QAAQ,CAAE,EAAE,CAAEF,OAAO,CAAE,WAAY,CAAE,CAAAN,QAAA,CAAC,cAAE,CAAQ,CAAC,CAC7E,CAAC,EACF,CAAC,EACJ,CAAC,EACH,CAAC,CAEV,CAEA,cAAe,CAAAzD,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}